//TODO:This autogenerated class includes the basics for a Registration
//Handler class. You will need to customize it to ensure it meets your needs and
//the data provided by the third party.

global class AutocreatedRegHandler1725519770444 implements Auth.RegistrationHandler{

global User createUser(Id portalId, Auth.UserData data){
    //The user is authorized, so create their Salesforce user
    List<User> userLists = [Select Id,Username,Email from User Where Email  = : data.email];
    If(userLists.isEmpty()){
    User u = new User();
    Profile p = [SELECT Id FROM profile WHERE name='Chatter Free User'];
    //TODO: Customize the username. Also check that the username doesn't already exist and
    //possibly ensure there are enough org licenses to create a user. Must be 80 characters
    //or less.
    System.debug(data);
    String FirstName = data.fullName.substringBefore(' ');
    String LastName = data.fullName.substringAfter(' ');
    System.debug('FirstName '+ FirstName );
    u.username = FirstName  +'_'+ data.email;
    u.email = data.email;
    u.lastName = LastName ;
    u.firstName = FirstName ;
    String alias = data.fullName.substringBefore(' ').substring(0, 1).toLowerCase()+data.fullName.substringAfter(' ');
    //Alias must be 8 characters or less
    if(alias.length() > 8) {
        alias = alias.substring(0, 8);
    }
    u.alias = alias;
    u.languagelocalekey = 'en_US';
    u.localesidkey = 'en_US';
    u.emailEncodingKey = 'UTF-8';
    u.timeZoneSidKey = 'America/Los_Angeles';
    u.profileId = p.Id;
    return u;
    }
    else{
        System.debug('Inside else');
        return null;
    }
}

global void updateUser(Id userId, Id portalId, Auth.UserData data){
    String userEmail = data.email;
    List<User> userLists = [Select Id,Username,Email from User Where Email = : userEmail];
    If(userLists.isEmpty()){
    User u = new User(id=userId);
    //TODO: Customize the username. Must be 80 characters or less.
    //u.username = FirstName  +'_'+ data.email;
    String FirstName = data.fullName.substringBefore(' ');
    String LastName = data.fullName.substringAfter(' ');
    u.email = data.email;
    u.lastName = data.LastName ;
    u.firstName = data.FirstName ;
    //String alias = data.username;
    //Alias must be 8 characters or less
    //if(alias.length() > 8) {
        //alias = alias.substring(0, 8);
    //}
    //u.alias = alias;
    update(u);
    }
    else{
        System.debug('Inside else');
    }
    
}
}